{"description":"NullPointerException is thrown when building UCFG for unknown method (as type inference in SonarJava can\u0027t resolve some of symbols)\r\n{code}\r\nimport java.util.Set;\r\nimport java.util.Collection;\r\nimport java.util.stream.Collectors;\r\npublic class A {\r\n  void foo(Set\u003cString\u003e arg) { \r\n    arg.stream()\r\n      .flatMap(Collection::stream)\r\n      .collect(Collectors.toCollection(LinkedHashSet::new)); \r\n  }\r\n}\r\n{code}\r\n\r\n{code}\r\njava.lang.NullPointerException\r\n\tat com.sonar.security.UCFGJavaVisitor.isString(UCFGJavaVisitor.java:265)\r\n\tat com.sonar.security.UCFGJavaVisitor.buildMethodInvocation(UCFGJavaVisitor.java:200)\r\n\tat com.sonar.security.UCFGJavaVisitor.buildCall(UCFGJavaVisitor.java:173)\r\n\tat com.sonar.security.UCFGJavaVisitor.lambda$buildBasicBlock$7(UCFGJavaVisitor.java:135)\r\n\tat java.lang.Iterable.forEach(Iterable.java:75)\r\n\tat com.sonar.security.UCFGJavaVisitor.buildBasicBlock(UCFGJavaVisitor.java:135)\r\n\tat com.sonar.security.UCFGJavaVisitor.buildUCfg(UCFGJavaVisitor.java:87)\r\n\tat com.sonar.security.UCFGJavaVisitor.visitMethod(UCFGJavaVisitor.java:71)\r\n\tat org.sonar.java.model.declaration.MethodTreeImpl.accept(MethodTreeImpl.java:216)\r\n\tat org.sonar.plugins.java.api.tree.BaseTreeVisitor.scan(BaseTreeVisitor.java:41)\r\n\tat org.sonar.plugins.java.api.tree.BaseTreeVisitor.scan(BaseTreeVisitor.java:35)\r\n\tat org.sonar.plugins.java.api.tree.BaseTreeVisitor.visitClass(BaseTreeVisitor.java:69)\r\n\tat org.sonar.java.model.declaration.ClassTreeImpl.accept(ClassTreeImpl.java:202)\r\n\tat org.sonar.plugins.java.api.tree.BaseTreeVisitor.scan(BaseTreeVisitor.java:41)\r\n\tat org.sonar.plugins.java.api.tree.BaseTreeVisitor.scan(BaseTreeVisitor.java:35)\r\n\tat org.sonar.plugins.java.api.tree.BaseTreeVisitor.visitCompilationUnit(BaseTreeVisitor.java:53)\r\n\tat com.sonar.security.UCFGJavaVisitorTest.assertCodeToUCfg(UCFGJavaVisitorTest.java:576)\r\n\tat com.sonar.security.UCFGJavaVisitorTest.assertCodeToUCfg(UCFGJavaVisitorTest.java:568)\r\n\tat com.sonar.security.UCFGJavaVisitorTest.unknown_method(UCFGJavaVisitorTest.java:553)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.lang.reflect.Method.invoke(Method.java:498)\r\n\tat org.junit.platform.commons.util.ReflectionUtils.invokeMethod(ReflectionUtils.java:436)\r\n\tat org.junit.jupiter.engine.execution.ExecutableInvoker.invoke(ExecutableInvoker.java:115)\r\n\tat org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.lambda$invokeTestMethod$6(TestMethodTestDescriptor.java:167)\r\n\tat org.junit.jupiter.engine.execution.ThrowableCollector.execute(ThrowableCollector.java:40)\r\n\tat org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.invokeTestMethod(TestMethodTestDescriptor.java:163)\r\n\tat org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:110)\r\n\tat org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:57)\r\n\tat org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor.lambda$execute$3(HierarchicalTestExecutor.java:83)\r\n\tat org.junit.platform.engine.support.hierarchical.SingleTestExecutor.executeSafely(SingleTestExecutor.java:66)\r\n\tat org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor.execute(HierarchicalTestExecutor.java:77)\r\n\tat org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor.lambda$null$2(HierarchicalTestExecutor.java:92)\r\n\tat java.util.stream.ForEachOps$ForEachOp$OfRef.accept(ForEachOps.java:184)\r\n\tat java.util.stream.ReferencePipeline$2$1.accept(ReferencePipeline.java:175)\r\n\tat java.util.Iterator.forEachRemaining(Iterator.java:116)\r\n\tat java.util.Spliterators$IteratorSpliterator.forEachRemaining(Spliterators.java:1801)\r\n\tat java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)\r\n\tat java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)\r\n\tat java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)\r\n\tat java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)\r\n\tat java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)\r\n\tat java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)\r\n\tat org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor.lambda$execute$3(HierarchicalTestExecutor.java:92)\r\n\tat org.junit.platform.engine.support.hierarchical.SingleTestExecutor.executeSafely(SingleTestExecutor.java:66)\r\n\tat org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor.execute(HierarchicalTestExecutor.java:77)\r\n\tat org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor.lambda$null$2(HierarchicalTestExecutor.java:92)\r\n\tat java.util.stream.ForEachOps$ForEachOp$OfRef.accept(ForEachOps.java:184)\r\n\tat java.util.stream.ReferencePipeline$2$1.accept(ReferencePipeline.java:175)\r\n\tat java.util.Iterator.forEachRemaining(Iterator.java:116)\r\n\tat java.util.Spliterators$IteratorSpliterator.forEachRemaining(Spliterators.java:1801)\r\n\tat java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)\r\n\tat java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)\r\n\tat java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)\r\n\tat java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)\r\n\tat java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)\r\n\tat java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)\r\n\tat org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor.lambda$execute$3(HierarchicalTestExecutor.java:92)\r\n\tat org.junit.platform.engine.support.hierarchical.SingleTestExecutor.executeSafely(SingleTestExecutor.java:66)\r\n\tat org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor.execute(HierarchicalTestExecutor.java:77)\r\n\tat org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor.execute(HierarchicalTestExecutor.java:51)\r\n\tat org.junit.platform.engine.support.hierarchical.HierarchicalTestEngine.execute(HierarchicalTestEngine.java:43)\r\n\tat org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:170)\r\n\tat org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:154)\r\n\tat org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:90)\r\n\tat com.intellij.junit5.JUnit5IdeaTestRunner.startRunnerWithArgs(JUnit5IdeaTestRunner.java:62)\r\n\tat com.intellij.rt.execution.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:47)\r\n\tat com.intellij.rt.execution.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:242)\r\n\tat com.intellij.rt.execution.junit.JUnitStarter.main(JUnitStarter.java:70)\r\n{code}\r\n\r\nCan be reproduces with SonarJava sources","component":"SonarJava","component_version":"5.3"}